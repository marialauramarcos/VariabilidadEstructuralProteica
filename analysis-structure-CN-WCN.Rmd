---
title: "Structural Divergence Analysis"
author: "Maria Laura Marcos, Julian Echave"
output: html_document
---

# Introduction
We study the evolutionary divergence of proteins using the LF-ENM and comparing simulated mutants with experimental data.

```{r setup, include = FALSE}
# set chunk options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r load-packages}
# load packages
library(ggplot2)
library(reshape2)
library(plyr)
library(quantreg)
library(bio3d)

# load functions
source("FUNCTIONS/ReadCA.R") 
source("FUNCTIONS/CalculateSideChainCM.R")
source(file.path(data.dir, "multiplot.R"))
source(file.path(data.dir, "my-functions.R"))
```

```{r set-file-names}
# set input filenames

## CM
data.dir <- paste("OUT/out_subset_CM_ANM", sep = "")
R0 = R0.CM
  
## data
reference.fname = file.path(data.dir, paste(family, "_ref.txt", sep = ""))
protein_list.fname = file.path(data.dir, paste(family, "_list.txt", sep = ""))

## profiles to compare
dri2.exp.fname = file.path(data.dir, paste(family, "_R0_", R0, "_beta_no.sel_K.analysis_Keff_out_m.exp.norm.dr.squarei.csv", sep = ""))
dri2.medium.fname = file.path(data.dir, paste(family, "_R0_", R0, "_beta_medium.sel_K.analysis_Keff_out_m.theo.norm.dr.squarei.csv", sep = ""))
dri2.mut.fname = file.path(data.dir,paste(family, "_R0_", R0, "_beta_no.sel_K.analysis_Keff_out_m.theo.norm.dr.squarei.csv", sep = ""))

## consurf
score.fname = file.path(data.dir, paste(p.ref, "_consurf.csv", sep = ""))
sim.data.mut.fname = file.path(data.dir, paste(family, "_R0_", R0, "_beta_no.sel_out_df.data.csv", sep = ""))
sim.data.medium.sel.fname = file.path(data.dir, paste(family, "_R0_", R0, "_beta_medium.sel_out_df.data.csv", sep = ""))
```

```{r set-reference-protein}
# which is the reference protein?
reference = as.character(read.table(reference.fname, header = F)[1, 1])
if (reference != p.ref) {
  print("Warning: different references")
}
```

In this case we studied the `r family` family. 
We used as reference for the ENM the protein with pdb code `r reference`. 
We simulated `r n.mut.p` mutants of this reference for each protein of the family.
The `r family` family is of the type `r type` and consists of the following proteins:

```{r set-experimental-protein-names}
# experimental protein names
protein.exp = read.table(protein_list.fname, header = F, stringsAsFactors = F)[, 1]
protein.exp = protein.exp[protein.exp != reference]
print(protein.exp)
```

```{r set-site-info, include = FALSE}

# read reference pdb and calculate resno, AA, and CN
reference.pdb.fname = file.path(data.dir,paste(reference, ".pdb", sep = ""))
ref.pdb = read.pdb(reference.pdb.fname)
inds = atom.select(ref.pdb, elety = "CA")
ref.pdb.ca = ref.pdb$atom[inds$atom, ]
n.sites = length(ref.pdb.ca$resid)
AA = ref.pdb.ca$resid
resno = seq(1:n.sites)
pdb.info = data.frame(resno, AA)
names(pdb.info) = c("resno", "AA")
print(n.sites)

site.info = pdb.info

### CA ###

# calculate CN
R0 = 5
cmap.ca.1 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.1.CA = rowSums(cmap.ca.1, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

R0 = 7.5
cmap.ca.2 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.2.CA = rowSums(cmap.ca.2, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

R0 = 10
cmap.ca.3 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.3.CA = rowSums(cmap.ca.3, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

R0 = 12.5
cmap.ca.4 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.4.CA = rowSums(cmap.ca.4, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

R0 = 15
cmap.ca.5 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.5.CA = rowSums(cmap.ca.5, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

R0 = 17.5
cmap.ca.6 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.6.CA = rowSums(cmap.ca.6, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

R0 = 20
cmap.ca.7 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.7.CA = rowSums(cmap.ca.7, na.rm = T) - 1 # diag(cmap.ca) returned by cmap is 1!

# calculate WCN
r.p.ref = matrix(ref.pdb$xyz[inds$xyz], nrow=3)
dist.r.p.ref = dist.xyz(t(r.p.ref))
WCN.CA = c()
for (i in (1:ncol(r.p.ref))) {
  WCN.CA[i] = sum(1/dist.r.p.ref[i, -i]^2)
}

### CM ###

# Read PDB of p.ref
pdb.ca = ReadCA(reference.pdb.fname, chain.p.ref)
r.ca.p.ref = pdb.ca$xyz.calpha
r.CM.p.ref = CalculateSideChainCM(reference.pdb.fname, chain.p.ref)
r.p.ref = cbind(r.CM.p.ref, r.ca.p.ref)
  
# calculate CN
R0 = 5
cmap.CM.1 = cmap(as.vector(r.p.ref), dcut = R0, scut = 0, mask.lower = F)
CN.1.CM = (rowSums(cmap.CM.1, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

R0 = 7.5
cmap.CM.2 = cmap(as.vector(r.p.ref), dcut = R0, scut = 0, mask.lower = F)
CN.2.CM = (rowSums(cmap.CM.2, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

R0 = 10
cmap.CM.3 = cmap(as.vector(r.p.ref), dcut = R0, scut = 0, mask.lower = F)
CN.3.CM = (rowSums(cmap.CM.3, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

R0 = 12.5
cmap.CM.4 = cmap(as.vector(r.p.ref), dcut = R0, scut = 0, mask.lower = F)
CN.4.CM = (rowSums(cmap.CM.4, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

R0 = 15
cmap.CM.5 = cmap(as.vector(r.p.ref), dcut = R0, scut = 0, mask.lower = F)
CN.5.CM = (rowSums(cmap.CM.5, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

R0 = 17.5
cmap.CM.6 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.6.CM = (rowSums(cmap.CM.6, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

R0 = 20
cmap.CM.7 = cmap(ref.pdb$xyz[inds$xyz], dcut = R0, scut = 0, mask.lower = F)
CN.7.CM = (rowSums(cmap.CM.6, na.rm = T) - 2)[1:ncol(r.CM.p.ref)]

# calculate WCN
dist.r.CM.p.ref = dist.xyz(t(r.p.ref))
WCN.CM = c()
for (i in (1:ncol(r.CM.p.ref))) {
  WCN.CM[i] = sum(1/dist.r.CM.p.ref[i, -c(i, (i + ncol(r.CM.p.ref)))]^2)
}

```

```{r read-data}
# read data
## exp
dri2.exp = read.csv(dri2.exp.fname, header = T)
site = site.info$site
rownames(dri2.exp) = paste("exp", rownames(dri2.exp), sep = "")

## mut
dri2.mut = read.csv(dri2.mut.fname, header = T)
rownames(dri2.mut) = paste("mut", rownames(dri2.mut), sep = "")

## medium
dri2.medium = read.csv(dri2.medium.fname, header = T)
rownames(dri2.medium) = paste("medium", rownames(dri2.medium), sep = "")
```


```{r prepare-site-data}
# prepare the data
## exp
tdri2.exp = as.data.frame(t(as.matrix(dri2.exp)))
tdri2.exp = cbind(site.info, tdri2.exp)
siteComparison.exp = melt(tdri2.exp, id.vars = names(site.info), variable.name = "protein", value.name = "dri2")

## mut
tdri2.mut = as.data.frame(t(as.matrix(dri2.mut)))
tdri2.mut = cbind(site.info, tdri2.mut)
siteComparison.mut = melt(tdri2.mut, id.vars = names(site.info), variable.name = "protein", value.name = "dri2")

## medium
tdri2.medium = as.data.frame(t(as.matrix(dri2.medium)))
tdri2.medium = cbind(site.info, tdri2.medium)
siteComparison.medium = melt(tdri2.medium, id.vars = names(site.info), variable.name = "protein", value.name = "dri2")

# bluild the data.frame
siteComparison.all.datasets = rbind(data.frame("dataset" = "exp", siteComparison.exp),
                                    data.frame("dataset" = "mut", siteComparison.mut),
                                    data.frame("dataset" = "medium", siteComparison.medium))

siteComparison.all.datasets = ddply(siteComparison.all.datasets, c("dataset", "protein"), mutate,
                     "n.SD" = dri2/mean(dri2, na.rm = T),
                     "z.SD" = vscale(dri2),
                      "RSD" = sqrt(dri2),
                    "n.RSD" = RSD/mean(RSD, na.rm = T),
                    "z.RSD" = vscale(RSD))
```


```{r mean-se-z.RSD-vs-site}
# comparison of z.RSD profiles with functional sites
## prepare dat
dat = siteComparison.all.datasets
dat$dataset = revalue(dat$dataset, c("medium" = "selection"))
dat$dataset = revalue(dat$dataset, c("mut" = "no-selection"))

## dat with means and standard errors
d = ddply(dat,c("dataset", "resno"), function(x) {
                mean.z.RSD = mean(x$z.RSD, na.rm = T)
                ndata = sum(!is.na(x$z.RSD))
                se.z.RSD = sd(x$z.RSD, na.rm = T) / sqrt(ndata)
                data.frame(mean.z.RSD, ndata, se.z.RSD)
})


# calculate correlations berween profiles
d.exp = subset(d, dataset == "exp")
d.mut = subset(d, dataset == "no-selection")
d.medium = subset(d, dataset == "selection")
```
### Sequence - structure comparison

1 = R0 5
2 = R0 7.5
3 = R0 10
4 = R0 12.5
5 = R0 15
6 = R0 17.5
7 = R0 20

```{r structure-CN-WCN-CA-comparison}

# compare profiles
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.1.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.1.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.1.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.1.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.1.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.1.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.1.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.1.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.1.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

######## 

## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.2.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.2.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.2.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.2.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.2.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.2.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.2.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.2.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.2.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

######
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.3.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.3.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.3.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.3.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.3.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.3.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.3.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.3.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.3.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#######
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.4.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.4.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.4.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.4.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.4.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.4.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.4.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.4.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.4.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#####
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.5.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.5.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.5.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.5.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.5.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.5.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.5.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.5.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.5.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#####
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.6.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.6.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.6.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.6.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.6.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.6.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.6.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.6.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.6.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#####
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.7.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.7.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.7.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.7.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.7.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.7.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.7.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.7.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.7.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")


# WCN
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(WCN.CA), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(WCN.CA), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(WCN.CA), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(WCN.CA))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(WCN.CA))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(WCN.CA))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(WCN)", "<z.RSD> no-selection vs log(WCN)", "<z.RSD> selection vs log(WCN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (WCN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(WCN.CA), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(WCN.CA), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(WCN.CA), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(WCN)", "<z.RSD> no-selection vs log(WCN)", "<z.RSD> selection vs log(WCN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (WCN)")

```

```{r structure-CN-WCN-CM-comparison}

# compare profiles
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.1.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.1.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.1.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.1.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.1.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.1.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.1.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.1.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.1.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

######## 

## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.2.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.2.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.2.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.2.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.2.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.2.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.2.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.2.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.2.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

######
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.3.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.3.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.3.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.3.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.3.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.3.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.3.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.3.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.3.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#######
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.4.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.4.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.4.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.4.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.4.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.4.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.4.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.4.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.4.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#####
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.5.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.5.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.5.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.5.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.5.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.5.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.5.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.5.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.5.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#####
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.6.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.6.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.6.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.6.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.6.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.6.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.6.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.6.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.6.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")

#####
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(CN.7.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(CN.7.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(CN.7.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.7.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.7.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.7.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (CN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(CN.7.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(CN.7.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(CN.7.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(CN)", "<z.RSD> no-selection vs log(CN)", "<z.RSD> selection vs log(CN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (CN)")


# WCN
## plot
par(pty = "s")

plot(x = d.exp$mean.z.RSD, y = log(WCN.CM), xlab = "<zRSDi> experimental")
plot(x = d.mut$mean.z.RSD, y = log(WCN.CM), xlab = "<zRSDi> no-selection")
plot(x = d.medium$mean.z.RSD, y = log(WCN.CM), xlab = "<zRSDi> selection")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(WCN.CM))
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(WCN.CM))
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(WCN.CM))

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(WCN)", "<z.RSD> no-selection vs log(WCN)", "<z.RSD> selection vs log(WCN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Pearson Correlation structure (<z.RSD>) - sequence (WCN)")

## calculate correlations
r.exp.mean.z.RSD.CN = cor(d.exp$mean.z.RSD, log(WCN.CM), method = "spearman")
r.mut.mean.z.RSD.CN = cor(d.mut$mean.z.RSD, log(WCN.CM), method = "spearman")
r.medium.mean.z.RSD.CN = cor(d.medium$mean.z.RSD, log(WCN.CM), method = "spearman")

cor.df = data.frame("comparison" = c("<z.RSD> experimental vs log(WCN)", "<z.RSD> no-selection vs log(WCN)", "<z.RSD> selection vs log(WCN)"),
                    "R" = c(r.exp.mean.z.RSD.CN , r.mut.mean.z.RSD.CN, r.medium.mean.z.RSD.CN))

knitr::kable(cor.df, digits = 2, caption = "Spearman Correlation structure (<z.RSD>) - sequence (WCN)")

```