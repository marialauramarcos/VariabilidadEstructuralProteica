{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Estudio variabilidad estructural proteica\"\ndate: \"30/01/2016\"\noutput: html_document\n---\n```{r setup, include = FALSE}\nknitr::opts_chunk$set(warning = FALSE, echo = FALSE, message = FALSE)\n```\n\n```{r}\n\n# Source functions.\nsource(\"FUNCTIONS/CalculateGroupsMeansQuantiles.R\")\n\n# Nmodes to analyze.\nnmodes1 = 10 \nnmodes2 = 25\nnmodes3 = 50\nnmodes4 = 100\n\n# Read files and calculate measures.\n\n### Experimental ###\n\npdbid <- read.csv(file.path(data.dir, paste(family, \"_dataset.csv\", sep = \"\")))$pdbid\nn.exp = length(pdbid)\n\nn.sites.p.1 = read.csv(file.path(out.dir, paste(family, \"_out_m.n.sites.p.1.csv\", sep = \"\")))$V1[1]\nm.n.sites.p.2 = read.csv(file.path(out.dir, paste(family, \"_out_m.n.sites.p.2.csv\", sep = \"\")))$V1\n\nn.core = read.csv(file.path(out.dir, paste(family, \"_out_m.n.core.csv\", sep = \"\")))$V1[1]\nm.n.aligned = read.csv(file.path(out.dir, paste(family, \"_out_m.n.aligned.csv\", sep = \"\")))$V1\n\nidentity = read.csv(file.path(out.dir, paste(family, \"_out_m.identity.csv\", sep = \"\")))$V1\n\n####\n\nm.exp.va = read.csv(file.path(out.dir, paste(family.model.naturalSelection.core, \"_out_m.exp.va.csv\", sep = \"\")))[, 1:nmodes4]\nmean.exp.va = colMeans(m.exp.va)\ni.mean.exp.va = 1/mean.exp.va\n\nm.exp.Pn = read.csv(file.path(out.dir, paste(family.model.naturalSelection.core, \"_out_m.exp.Pn.csv\", sep = \"\")))[, 1:nmodes4]\nmean.exp.Pn = colMeans(m.exp.Pn)\n\nexp.Pn.quantile1 = matrix(0, ncol = ncol(m.exp.Pn), nrow = 1)\nexp.Pn.quantile2 = matrix(0, ncol = ncol(m.exp.Pn), nrow = 1)\n\nfor (i in (1:ncol(m.exp.Pn))){\n    exp.Pn.quantiles <- as.vector(quantile((m.exp.Pn[, i]), probs = c(0.05, 0.95)))\n    exp.Pn.quantile1[1, i] = exp.Pn.quantiles[1]\n    exp.Pn.quantile2[1, i] = exp.Pn.quantiles[2]\n}\n\nm.exp.dr.squarei = read.csv(file.path(out.dir, paste(family.model.naturalSelection.core, \"_out_m.exp.dr.squarei.csv\", sep = \"\")))\nexp.MSDi = colMeans(m.exp.dr.squarei, na.rm = T )\nexp.MSD = rowMeans(m.exp.dr.squarei, na.rm = T)\n\nm.exp.Qn = t(apply(m.exp.Pn, 1, cumsum))\nmean.exp.Qn = colMeans(m.exp.Qn)\n\nfamily.data <- data.frame(pdbid, nsites = m.n.sites.p.2, naligned = m.n.aligned, identity, MSD = exp.MSD)\n\n### Theoretical ###\nm.theo.va = read.csv(file.path(out.dir, paste(family.model.naturalSelection.core, \"_out_m.theo.va.csv\", sep = \"\")))[, 1:nmodes4]\nmean.theo.va = colMeans(m.theo.va)\ni.mean.theo.va = 1/mean.theo.va\n\nm.theo.Pn = read.csv(file.path(out.dir, paste(family.model.naturalSelection.core, \"_out_m.theo.Pn.csv\", sep = \"\")))[, 1:nmodes4]\nn.mut = nrow(m.theo.Pn)\n\nm.theo.dr.squarei = read.csv(file.path(out.dir, paste(family.model.naturalSelection.core, \"_out_m.theo.dr.squarei.csv\", sep = \"\")))\ntheo.MSDi = colMeans(m.theo.dr.squarei, na.rm = T)\ntheo.MSD = rowMeans(m.theo.dr.squarei, na.rm = T)\n\ntheo.MSD.group <- CalculateGroupsMeansQuantiles(cbind(theo.MSD,theo.MSD), n.exp, n.mut.p)\nmean.theo.MSD.group <- theo.MSD.group$mean.group[,1]\n\nm.theo.Qn = t(apply(m.theo.Pn, 1, cumsum))\n\n```\n\n## Conjuntos de proteinas\n\n### Conjunto teorico\n`r n.mut` mutantes de `r p.ref` (`r n.sites.p.1` sitios) simuladas con el modelo mutacional `r mut.model` con ANM *R0* = `r R0` y *Fmax* = 2 (solo para LFENM). Para determinar que sitios mutar, se alineo `r p.ref` con cada una de las proteinas del conjunto, se obtuvieron los indices de los sitios alineados pero mutados y se simularon `r n.mut.p` mutantes por cada par de proteinas, obteniendose un total de `r n.mut.p * n.exp` mutantes. Luego, para el analisis, se tomaron como alineados los sitios alineados de `r p.ref` para cada par de proteinas.\n\n### Conjunto experimental \n`r n.exp` proteinas de la familia de `r family`. Las proteinas tienen un promedio de identidad secuencial de `r round(mean(identity))`%. El core del alineamiento de la familia es de `r n.core` sitios.\n\nLa caracterizacion del conjunto experimental se muestra a continuacion:\n```{r}\nfamily.data\n\nlayout(matrix(1:4, 2, 2, byrow = T)) \nhist(exp.MSD, main = \"Experimental MSD\", xlab = \"MSD\")\nhist(theo.MSD, main = \"Theoretical MSD\", xlab = \"MSD\")\n\nplot(exp.MSD, identity, xlab = \"experimental MSD\")\nplot(mean.theo.MSD.group, identity, xlab = \"mean theoretical MSD\")\n\n```\n\n```{r}\n# Calculate rho.\nrho.t.1 <- matrix(0, nrow = n.mut, ncol = 1)\nrho.t.2 <- matrix(0, nrow = n.mut, ncol = 1)\nrho.t.3 <- matrix(0, nrow = n.mut, ncol = 1)\nrho.t.4 <- matrix(0, nrow = n.mut, ncol = 1)\nfor (i in (1:n.mut)) {\n  rho.t.1[i, ] <- cor((as.vector(as.matrix(m.theo.Pn[i, 1:nmodes1])) * mean.theo.va[1:nmodes1]), i.mean.theo.va[1:nmodes1], method = \"pearson\")\t\n  rho.t.2[i, ] <- cor((as.vector(as.matrix(m.theo.Pn[i, 1:nmodes2])) * mean.theo.va[1:nmodes2]), i.mean.theo.va[1:nmodes2], method = \"pearson\")\t\n  rho.t.3[i, ] <- cor((as.vector(as.matrix(m.theo.Pn[i, 1:nmodes3])) * mean.theo.va[1:nmodes3]), i.mean.theo.va[1:nmodes3], method = \"pearson\")\t\n  rho.t.4[i, ] <- cor((as.vector(as.matrix(m.theo.Pn[i, 1:nmodes4])) * mean.theo.va[1:nmodes4]), i.mean.theo.va[1:nmodes4], method = \"pearson\")\t   \n}\nrho.e.1 <- matrix(0, nrow = n.exp, ncol = 1)\nrho.e.2 <- matrix(0, nrow = n.exp, ncol = 1)\nrho.e.3 <- matrix(0, nrow = n.exp, ncol = 1) \nrho.e.4 <- matrix(0, nrow = n.exp, ncol = 1) \nfor (i in (1:n.exp)) {\n  rho.e.1[i, ] <- cor((as.vector(as.matrix(m.exp.Pn[i, 1:nmodes1])) * mean.exp.va[1:nmodes1]), i.mean.exp.va[1:nmodes1], method = \"pearson\")\n  rho.e.2[i, ] <- cor((as.vector(as.matrix(m.exp.Pn[i, 1:nmodes2])) * mean.exp.va[1:nmodes2]), i.mean.exp.va[1:nmodes2], method = \"pearson\")\n  rho.e.3[i, ] <- cor((as.vector(as.matrix(m.exp.Pn[i, 1:nmodes3])) * mean.exp.va[1:nmodes3]), i.mean.exp.va[1:nmodes3], method = \"pearson\")\n  rho.e.4[i, ] <- cor((as.vector(as.matrix(m.exp.Pn[i, 1:nmodes4])) * mean.exp.va[1:nmodes4]), i.mean.exp.va[1:nmodes4], method = \"pearson\")\n}\n\n# Calculate auc.\nauc.t.1 <- matrix(0, nrow = n.mut, ncol = 1)\nauc.t.2 <- matrix(0, nrow = n.mut, ncol = 1)\nauc.t.3 <- matrix(0, nrow = n.mut, ncol = 1)\nauc.t.4 <- matrix(0, nrow = n.mut, ncol = 1)\nfor (i in (1:n.mut)) {\n  auc.t.1[i, ] <- auc(seq(1:nmodes1), m.theo.Qn[i,1:nmodes1])\n  auc.t.2[i, ] <- auc(seq(1:nmodes2), m.theo.Qn[i,1:nmodes2])\n  auc.t.3[i, ] <- auc(seq(1:nmodes3), m.theo.Qn[i,1:nmodes3])\n  auc.t.4[i, ] <- auc(seq(1:nmodes4), m.theo.Qn[i,1:nmodes4])\n}\nauc.e.1 <- matrix(0, nrow = n.exp, ncol = 1)\nauc.e.2 <- matrix(0, nrow = n.exp, ncol = 1)\nauc.e.3 <- matrix(0, nrow = n.exp, ncol = 1)\nauc.e.4 <- matrix(0, nrow = n.exp, ncol = 1)\nfor (i in (1:n.exp)) {\n  auc.e.1[i, ] <- auc(seq(1:nmodes1), m.exp.Qn[i, 1:nmodes1])\n  auc.e.2[i, ] <- auc(seq(1:nmodes2), m.exp.Qn[i, 1:nmodes2])\n  auc.e.3[i, ] <- auc(seq(1:nmodes3), m.exp.Qn[i, 1:nmodes3])\n  auc.e.4[i, ] <- auc(seq(1:nmodes4), m.exp.Qn[i, 1:nmodes4])\n}\n``` \n\n## Comparaciones\n\n### RHO y AUC\nLas distribuciones de *auc* y *rho* para cada conjunto se muestran a continuacion (azul= teorico, rojo = experimental)\n\n```{r}\nlayout(matrix(1:4, 2, 2, byrow = T))\nplot(density(rho.t.1), col = \"blue\", ylab = \"Frecuencia\", xlab = \"rho\", main = \"Histograma rho 10 modos\")\npoints(x = c(rho.e.1), y = rep(0, n.exp), col = \"red\")\nplot(density(auc.t.1), col = \"blue\", ylab = \"Frecuencia\", xlab = \"auc\", main = \"Histograma auc 10 modos\")\npoints(x = c(auc.e.1), y = rep(0, n.exp), col = \"red\")\nplot(density(rho.t.2), col = \"blue\", ylab = \"Frecuencia\", xlab = \"rho\", main = \"Histograma rho 25 modos\")\npoints(x = c(rho.e.2), y = rep(0, n.exp), col = \"red\")\nplot(density(auc.t.2), col = \"blue\", ylab = \"Frecuencia\", xlab = \"auc\", main = \"Histograma auc 25 modos\")\npoints(x = c(auc.e.2), y = rep(0, n.exp), col = \"red\")\n```\n\n```{r}\nlayout(matrix(1:4, 2, 2, byrow = T))\nplot(density(rho.t.3), col = \"blue\", ylab = \"Frecuencia\", xlab = \"rho\", main = \"Histograma rho 50 modos\")\npoints(x = c(rho.e.3), y = rep(0, n.exp), col = \"red\")\nplot(density(auc.t.3), col = \"blue\", ylab = \"Frecuencia\", xlab = \"auc\", main = \"Histograma auc 50 modos\")\npoints(x = c(auc.e.3), y = rep(0, n.exp), col = \"red\")\nplot(density(rho.t.4), col = \"blue\", ylab = \"Frecuencia\", xlab = \"rho\", main = \"Histograma rho 100 modos\")\npoints(x = c(rho.e.4), y = rep(0, n.exp), col = \"red\")\nplot(density(auc.t.4), col = \"blue\", ylab = \"Frecuencia\", xlab = \"auc\", main = \"Histograma auc 100 nmodos\")\npoints(x = c(auc.e.4), y = rep(0, n.exp), col = \"red\")\n```\n\n## Pn y Qn\nLas distribuciones de *Pn* y *Qn* de los conjuntos son las siguientes:\n  \n```{r}\n# Re-ordenate Pn and Qn.\nm.theo.index = matrix(ncol = 1, nrow = n.mut)\nfor (P in (1:n.exp)) {\n  for (mut in (1:n.mut.p)) {\n    m.theo.index[(P - 1) * n.mut.p + mut, ] = (mut - 1) * 10 + P\n  }\n}\nm.theo.Pn = m.theo.Pn[as.vector(m.theo.index), ]\nm.theo.Qn = m.theo.Qn[as.vector(m.theo.index), ]\n\n# Calculate groups, means and quantiles.\ntheo.Pn.group = CalculateGroupsMeansQuantiles(m.theo.Pn, n.mut.p, n.exp)\nmean.theo.Pn.group = theo.Pn.group$mean.mean.group\ntheo.Pn.group.quantile1 = theo.Pn.group$mean.quantile1.group\ntheo.Pn.group.quantile2 = theo.Pn.group$mean.quantile2.group\n\n# Graphics.\nlayout(matrix(1:2, 1, 2, byrow = T)) \n       \nplot(y = mean.theo.Pn.group, x = i.mean.theo.va, ylab = \"Pn promedio teorico\", xlab = \"1/evalue\") \nplot(y = mean.exp.Pn, x = i.mean.exp.va, ylab = \"Pn promedio experimental\", xlab = \"1/evalue\") \n  \n\nlayout(matrix(1:1, 1, 1, byrow = T)) \n\nplot(mean.theo.Pn.group, \n     ylab = \"Pn promedio\", \n     xlab = \"nmodo\", \n     type = \"l\", \n     ylim = c(0, max(c(theo.Pn.group.quantile2, mean.exp.Pn))))\nlines(theo.Pn.group.quantile1, col = \"green\")\nlines(theo.Pn.group.quantile2, col = \"green\")\npoints(mean.exp.Pn, col = \"red\")\nlines(as.vector(exp.Pn.quantile1), col = \"red\")\nlines(as.vector(exp.Pn.quantile2), col = \"red\")\n\n\n```\n\nNegro: Teorico\nRojo: Experimental\nVerdes: Cuartiles 0.01 y 0.99 de `r n.mut.p` grupos de `r n.exp` mutantes teoricas.",
    "created" : 1460209059443.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3753017519",
    "id" : "8B6D0163",
    "lastKnownWriteTime" : 1456679277,
    "last_content_update" : 1456679277,
    "path" : "C:/Users/Usuario/Desktop/VariabilidadEstructuralProteica/Report.Rmd",
    "project_path" : "Report.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}