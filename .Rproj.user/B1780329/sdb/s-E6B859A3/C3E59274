{
    "contents" : "---\ntitle: \"Comparaciones Teórico-Experimental\"\noutput: html_document\n---\n```{r setup, include = FALSE}\nknitr::opts_chunk$set(warning = FALSE, echo = FALSE, message = FALSE)\n```\n\n```{r, fig.width = 20, fig.height = 40}\n# INFORMACIÓN\n#\n# Este programa genera un archivo HTLM comparando la divergencia etsructural de\n# proteínas experimentales y mutantes teóricas.\n# Para correrlo se debe completar un Input (\"DATA/comp_input.csv\") especificando:\n# - family: la familia de proteínas a comparar, debe estar escrita consistentemente \n# con los archivos theoretical_input y experimental_input.\n# - p.ref: la proteína dereferencia de la familia, que debe ser escrita \n# consisntentemente con el archivo experimental_input, es decir que debe ser escrita de la \n# forma en la que está escrita en el dataset.\n# - heme: solo se utiliza para la familia de las globinas, puede ser \"TRUE\" o \n# \"FALSE\" dependiendo de si se quiere considerar o no al grupo HEMO.\n# - core: puede ser \"TRUE\" o \"FALSE\" dependiendo de si se quiere analizar solo los sectores\n# del alineamiento donde no hay gaps. \n\n# Remove objects.\nrm (list = ls())\n\n# Nmodes to analyze.\nnmodes1 = 10\nnmodes2 = 25\nnmodes3 = 100\n\n# Load librarys. \nlibrary(flux)  # function \"auc\".\n\n# Source functions. \nsource(\"FUNCTIONS/CalculateGroupsMeansQuantiles.R\")\n\n# Read Input.\ninput <- read.csv(\"DATA/comp_input.csv\")\n\n# Layout.\nlayout(matrix(1:(10 * nrow(input)), 2 * nrow(input), 5, byrow = T), widths = rep(10, 10 * nrow(input)), heights = rep(10, 10 * nrow(input)))\n\nfor (f in (1:nrow(input))) { \n  family <- input$family[f]\n  p.ref <- input$p.ref[f]\n  heme <- input$heme[f]\n  core <- input$core[f]\n\n  # Read files and calculate measures.\n  ## Read experimental output.\n  dir.e <- \"OUT/Experimental\"\n  if (as.character(family) == \"globins\") {\n    family <- paste(family, \"_heme_\", heme, sep = \"\")\n  }\n  family <- paste(family, \"_core_\", core, sep = \"\")\n\n  laligned = read.csv(file.path(dir.e, paste(family, \"_out_m.laligned.csv\", sep = \"\")))$x\n  index <- c()\n  for (i in (1:length(laligned))) {\n    if (laligned[i] == max(laligned)) {\n      index[i] <- i\n    }\n  }\n  index <- index[!is.na(index)]\n  \n  m.Pne = read.csv(file.path(dir.e, paste(family, \"_out_m.Pn.csv\", sep = \"\")))[index, 1:nmodes3]\n  Pne.mean = colMeans(m.Pne)\n  \n  m.Qne = t(apply(m.Pne, 1, cumsum))\nQne.mean = colMeans(m.Qne)\n\n  m.evaluese = read.csv(file.path(dir.e, paste(family, \"_out_m.evalues.csv\", sep = \"\")))[index, 1:nmodes3]\n  evaluese.mean = colMeans(m.evaluese)\n  ievaluese.mean = 1/evaluese.mean\n  \n  MSD = read.csv(file.path(dir.e, paste(family, \"_out_MSD.csv\", sep = \"\")))$x\n  \n  id = read.csv(file.path(dir.e, paste(family, \"_out_m.ID.csv\", sep = \"\")))$x\n  id.index = id[index]\n\n  ## Read theoretical output.\n  dir.t <- \"OUT/Theoretical\"\n  m.Pnt = read.csv(file.path(dir.t, paste(family, \"_out_m.Pn.csv\", sep = \"\")))[, 1:nmodes3]\n  evalues = read.csv(file.path(dir.t, paste(family, \"_out_evalues.csv\", sep = \"\")))$x[1:nmodes3]\n  m.Qnt = t(apply(m.Pnt, 1, cumsum))\n  ievalues = 1/evalues\n\n  # Number of t and e proteins.\n  nmut = nrow(m.Pnt)\n  nexp = length(index)\n\n  # Number of t groups.\n  ngroups = as.integer(nmut / nexp)\n\n  # Calculate rho and auc.\n  rho.t <- matrix(0, nrow = nmut, ncol = 2)\n  auc.t <- matrix(0, nrow = nmut, ncol = 2)\n\n  for (i in (1:nmut)) {\n    rho.t[i, 1] <- cor((as.vector(as.matrix(m.Pnt[i, 1:nmodes1])) * evalues[1:nmodes1]), ievalues[1:nmodes1], method = \"pearson\")\t\n    rho.t[i, 2] <- cor((as.vector(as.matrix(m.Pnt[i, 1:nmodes2])) * evalues[1:nmodes2]), ievalues[1:nmodes2], method = \"pearson\")\t\n    auc.t[i, 1] <- auc(seq(1:nmodes1), m.Qnt[i,1:nmodes1])\n    auc.t[i, 2] <- auc(seq(1:nmodes2), m.Qnt[i,1:nmodes2])\n  }\n\n  rho.e <- matrix(0, nrow = nexp, ncol = 2)\n  auc.e <- matrix(0, nrow = nexp, ncol = 2)\n\n  for (i in (1:nexp)) {\n    rho.e[i, 1] <- cor((as.vector(as.matrix(m.Pne[i, 1:nmodes1])) * evaluese.mean[1:nmodes1]), ievaluese.mean[1:nmodes1], method = \"pearson\")\n    rho.e[i, 2] <- cor((as.vector(as.matrix(m.Pne[i, 1:nmodes2])) * evaluese.mean[1:nmodes2]), ievaluese.mean[1:nmodes2], method = \"pearson\")\n    auc.e[i, 1] <- auc(seq(1:nmodes1), m.Qne[i, 1:nmodes1])\n    auc.e[i, 2] <- auc(seq(1:nmodes2), m.Qne[i, 1:nmodes2])\n  }\n\n  # Calculate groups, means and quantiles.\n  Pnt.group <- CalculateGroupsMeansQuantiles(m.Pnt, ngroups, nexp)\n  Pnt.group.mean <- Pnt.group$mean.total\n  Pnt.group.quantile5 <- Pnt.group$quantile[1, ]\n  Pnt.group.quantile95 <- Pnt.group$quantile[2, ] \n  \n  Qnt.group <- CalculateGroupsMeansQuantiles(m.Qnt, ngroups, nexp)\n  Qnt.group.mean <- Qnt.group$mean.total\n  Qnt.group.quantile5 <- Qnt.group$quantile[1, ]\n  Qnt.group.quantile95 <- Qnt.group$quantile[2, ]\n\n  # Plots.\n  hist(id, main = family, col = \"grey\", xlab = \"% ID con referencia\")\n  hist(laligned, main = family, xlab = \"Número de sitios alineados\", col = \"grey\")\n  hist(MSD, main = family, xlab = \"MSD\", col = \"grey\")\n\n  plot(Pnt.group.mean, ylab = \"Pn promedio\", xlab = \"nmodo\", type = \"l\", ylim = c(0, 0.07), main = family)\n  lines(Pnt.group.quantile5, col = \"green\")\n  lines(Pnt.group.quantile95, col = \"green\")\n  points(Pne.mean, col = \"red\")\n  \n  plot(y = Pnt.group.mean, x = ievalues, ylab = \"Pn promedio teórico\", xlab = \"1/evalue\", ylim = c(0, 0.07), main = family)\n   \n  plot(y = Pne.mean, x = ievaluese.mean, ylab = \"Pn promedio experimental\", xlab = \"1/evalue\", ylim = c(0, 0.07), main = family)\n\n  plot(density(rho.t[, 1]), col = \"blue\", ylab = \"Frecuencia\", xlab = \"rho 10 modos\", main = family)\n  points(x = c(rho.e[, 1]), y = rep(0, nexp), col = \"red\")\n\n  plot(density(rho.t[, 2]), col = \"blue\", ylab = \"Frecuencia\", xlab = \"rho 25 modos\", main = family)\n  points(x = c(rho.e[, 2]), y = rep(0, nexp), col = \"red\")\n\n  plot(density(auc.t[, 1]), col = \"blue\", ylab = \"Frecuencia\", xlab = \"auc 10 modos\", main = family)\n  points(x = c(auc.e[, 1]), y = rep(0, nexp), col = \"red\")\n\n  plot(density(auc.t[, 2]), col = \"blue\", ylab = \"Frecuencia\", xlab = \"auc 25 modos\", main = family)\n  points(x = c(auc.e[, 2]), y = rep(0, nexp), col = \"red\")\n}\n```\n\n\n\n",
    "created" : 1447627501116.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3878080328",
    "id" : "C3E59274",
    "lastKnownWriteTime" : 1447698112,
    "path" : "C:/Users/Laurita/Desktop/Doctorado/VariabilidadEstructuralProteica/MultipleComparisonsMain.Rmd",
    "project_path" : "MultipleComparisonsMain.Rmd",
    "properties" : {
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "type" : "r_markdown"
}