{
    "contents" : "# INFORMACIÓN:\n#\n# El programa genera mutantes múltiples de una proteína determinada usando el modelo mutacional Linearly \n# Forced - Elastic Network Model (LF-ENM) y considerando a las fuerzas que modelan cada mutación aditivas \n# entre sí. Además, calcula medidas de variabilidad estructural y dinámica entre las proteínas mutantes \n# generadas y la proteína de referencia.\n#\n# Para utilizar el programa se debe completar un input (\"DATA/Theoretical/inputT.csv\") especificando: \n# -family: la familia de proteínas a la que pertenece la proteína a mutar escrita en inglés y plural \n# (ej.:\"Globins\"). Tener en cuenta que las familias que pueden ser analizadas experimentalmente son\n# \"SerinProteases\", \"Globins\" o \"Plastocyanins\".\n# -p.ref: el código de pdb (pdbid) de la proteína a mutar (ej.:\"1a6m\")\n# -chain: la cadena de p.ref que se desea mutar.\n# -heme: solo se utiliza para la familia de las globinas, puede ser \"TRUE\" o \"FALSE\" dependiendo de \n# si se quiere considerar o no al grupo HEMO. \n# -nmut: la cantidad de mutantes a generar.\n# -nsitesmut: la cantidad de sitios mutados por proteína mutante.\n# -Fmax: valor máximo de las fuerzas usadas para la simulación de las mutaciones.\n# -model: el modelo de red elástica a usar, que solo puede ser \"ANM\" por el momento.\n# -R0: cut-off del ANM.\n\n#Remove objects#\nrm(list = ls()) \n\n#Read input#\ndata.dir <- \"DATA/Theoretical\"\n\ninput.dir <- file.path(data.dir,\"InputT.csv\")\ninput <- read.csv(input.dir)\n\n#Reference family and protein#\nfamily <- input$family\np.ref <- input$p.ref \nchain <- input$chain\nheme <- input$heme \n\n#Parameters for mutations#\nnmut = input$nmut \nnsitesmut = input$nsitesmut \nfmax = input$fmax \n\n#ENM#\nmodel <- input$model\nR0 = input$R0\n\n#PDB dir#\nget.pdb(as.character(p.ref),data.dir) \npdb.fname <- file.path(data.dir,paste(p.ref,\".pdb\",sep=\"\"))\n\n#Functions dir#\nf.readCA <-\"FUNCTIONS/ReadCA.R\" \nf.readHeme <- \"FUNCTIONS/ReadHeme.R\"  \nf.Keff <- \"FUNCTIONS/Keff.R\"  \nf.K <- \"FUNCTIONS/K.R\" \nf.kij.function <- file.path(\"FUNCTIONS\",paste(\"Kij.\",model,\".R\",sep = \"\")) \nf.force <- \"FUNCTIONS/Force.R\"  \nf.variability <- \"FUNCTIONS/Variability.R\"  \n\n#Output dir#\nOUT <- \"OUT/Theoretical\"\n\n#General parameters#\nTOLERANCE = 1e-10\n\n#Load librarys#\nlibrary(bio3d)\n\n#Load Functions#\nsource(f.readCA) \nsource(f.readHeme) \nsource(f.Keff)\nsource(f.K)\nsource(f.kij.function)\nsource(f.force)\nsource(f.variability)\n\n#Read PDB of p.ref#\npdb <- readCA(pdb.fname,chain)\nr.p.ref = pdb$xyz.calpha\nnsites = pdb$nsites\nnaa = nsites \n\nif ((family == \"Globins\") & (heme == \"TRUE\")){\n  r.heme = readHeme(pdb.fname,chain)\n  r.p.ref = cbind(r.p.ref,r.heme)\n  nsites = ncol(r.p.ref)\n  align.index = seq(1,naa)\n  no.align.index = seq((naa+1),nsites)\n}\n\n#Calculate K of p.ref#\nK.p.ref <- K(r.p.ref,kij.function,R0,TOLERANCE)\n\n#Variability#\nm.nH = matrix(ncol = 3*naa , nrow = nmut)\nm.Pn = matrix(ncol = 3*naa , nrow = nmut)\nm.d.evalues = matrix(ncol = 3*naa , nrow = nmut)\nm.dr.squarei = matrix(ncol = naa , nrow = nmut)\n\n#Count the number of mutants to discard#\ncount = 0\n\n#Calculate mutants#\nfor(mut in seq(nmut)){\n \tf <- rep(0,3*nsites)\n\tfor (l in (sample(1:naa,replace = F)[1:nsitesmut])){\n    print(c(mut,l))\n    fl = force(l,r.p.ref,K.p.ref$kij,fmax)\n\t\tf = f + fl\n\t}\n\n  dr = K.p.ref$Cov %*% f\n  dim(dr) <- c(3,nsites)\n  r.mut = r.p.ref + dr\n\n  #Rotate mutants minimizing RMSD with P.ref#\n\tr.mut <- matrix(fit.xyz(fixed = as.vector(r.p.ref), \n\tmobile = as.vector(r.mut),\n\tfixed.inds = seq(1,3*naa),\n\tmobile.inds = seq(1,3*naa)),nrow=3) \n\t\n\t#Calculate K of mutants and p.ref#\n  if (naa != nsites) {\n    K.mut <- keff(r.mut, align.index,no.align.index, kij.function,R0,TOLERANCE)\n    K.p.ref.2 <- keff(r.p.ref,align.index,no.align.index,kij.function,R0,TOLERANCE)\n  }\n  if (naa == nsites) {\n    K.mut <- K(r.mut,kij.function,R0,TOLERANCE)\n    K.p.ref.2 <- K.p.ref\n  }\n\t\n\tnmodes <- length(K.p.ref.2$va)  \n\t\n  #Calculate dr#\n  dr = (r.mut - r.p.ref)[,1:naa]   \n  \n\tif (ncol(K.mut$ve) == ncol(K.p.ref.2$ve)){ \n\t  \n\t  #Calculate measures o variability#\n\t\tVA <- variability(dr,K.p.ref.2,K.mut)\n    m.nH[mut,1:nmodes] = t(VA$nH)\n  \tm.Pn[mut,1:nmodes] = t(VA$Pn)\n    m.d.evalues[mut,1:nmodes]  = t(VA$d.evalues[1:nmodes])\n\t\tdr.squarei = rbind(VA$dr.squarei,seq(1,naa))\n\t\tfor (i in (1:naa)){\n\t\t\tm.dr.squarei[mut,i]= matrix(dr.squarei[1,dr.squarei[2,]==i],ncol=1,nrow=1)\n\t\t}\n\t}\n\tif (ncol(K.mut$ve) != ncol(K.p.ref.2$ve)){ \n\t  count <- count +1\n\t}\n}\n\n#Calculate Means#\nmean.nH = colMeans(as.matrix(m.nH),na.rm=T)\nmean.Pn = colMeans(as.matrix(m.Pn),na.rm=T)\nmean.d.evalues= colMeans(as.matrix(m.d.evalues),na.rm=T)\nMSDi = colMeans(as.matrix(m.dr.squarei),na.rm=T)\nMSD = rowMeans(m.dr.squarei,na.rm = T)\n\n#SAVE INFORMATION#\nif (family == \"Globins\") family <- paste(family,\"Heme\",heme,sep =\"\")\n\n#Dataframes#\nwrite.csv(m.nH,file = file.path(OUT , paste(family , \".Out.m.nH.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(m.Pn,file = file.path(OUT , paste(family , \".Out.m.Pn.csv\" , sep=\"\")) , row.names = FALSE)\nwrite.csv(m.d.evalues,file = file.path(OUT , paste(family , \".Out.m.d.evalues.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(m.dr.squarei,file = file.path(OUT , paste(family , \".Out.m.dr.squarei.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(K.p.ref.2$va,file = file.path(OUT , paste(family , \".Out.evalues.csv\" , sep = \"\")) , row.names = FALSE)\n\n#Means#\nwrite.csv(mean.nH,file = file.path(OUT , paste(family , \".Out.nH.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(mean.Pn,file = file.path(OUT , paste(family , \".Out.Pn.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(mean.d.evalues,file = file.path(OUT , paste(family , \".Out.d.evalues.mean.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(MSDi,file = file.path(OUT , paste(family , \".Out.MSDi.csv\" , sep = \"\")) , row.names = FALSE)\nwrite.csv(MSD,file = file.path(OUT , paste(family , \".Out.MSD.csv\", sep = \"\")) , row.names = FALSE)\n\n#input#\nwrite.csv(input,file = file.path(OUT , paste(family , \".Input\" , sep = \"\")) , row.names = FALSE)\n\n\n",
    "created" : 1444053588915.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3200226141",
    "id" : "DDAB9252",
    "lastKnownWriteTime" : 1444152752,
    "path" : "C:/Users/Laurita/Desktop/Doctorado/VariabilidadEstructuralProteica/TheoreticalMain.R",
    "project_path" : "TheoreticalMain.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}