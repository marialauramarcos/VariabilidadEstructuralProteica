---
title: "MSDi for all families together"
author: "Maria Laura Marcos"
output: html_document
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, echo = FALSE, message = FALSE)
```

```{r}

# Directories.
out.dir <- "OUT"

# Create vectors to keep data.
v.theo.MSDi.s.n = c()
v.exp.MSDi.s.n = c()

# Read input.
input.fname <- file.path("input_MainMultipleReport.csv")
input <- read.csv(input.fname)

# Print the input in the html file.
print(input)

# Start a loop to read data for each family.
for (a in (1:nrow(input))) { 
  family <- as.character(input$family)[a]
  R0 = input$R0[a]
  K.analysis = input$K.analysis[a]
  
  #Read experimental data.
  analysis.fname.id <- paste(family, "_R0_", R0,  "_beta_", beta, "_K.analysis_", K.analysis, sep = "")
  
  m.exp.smooth.norm.dr.squarei = read.csv(file.path(out.dir, paste(analysis.fname.id, "_out_m.exp.smooth.norm.dr.squarei.csv", sep = "")))
  
 exp.MSDi.s.n = colMeans(m.exp.smooth.norm.dr.squarei, na.rm = T )
  
  # Read theoretical data#
  m.theo.smooth.norm.dr.squarei = read.csv(file.path(out.dir, paste(analysis.fname.id, "_out_m.theo.smooth.norm.dr.squarei.csv", sep = "")))
  
 theo.MSDi.s.n = colMeans(m.theo.smooth.norm.dr.squarei, na.rm = T)
  
  ## Fit theoretical data with experimental data.
  
  fit.s.n = lm(exp.MSDi.s.n ~ theo.MSDi.s.n)
  fit.MSDi.s.n = fitted.values(fit.s.n)
  
  
  # Concatenate information.
  v.theo.MSDi.s.n = c(v.theo.MSDi.s.n, fit.MSDi.s.n)
  
  exp.MSDi.s.n = exp.MSDi.s.n[!is.na(exp.MSDi.s.n)]
  v.exp.MSDi.s.n = c(v.exp.MSDi.s.n, exp.MSDi.s.n)
}

# Caluclate measures.
R2.s.n = cor(theo.MSDi.s.n, exp.MSDi.s.n) ^ 2  
MSE.s.n = mean((theo.MSDi.s.n - exp.MSDi.s.n) ^ 2)

```

All families fitted smooth and normalized MSD profiles 

```{r}
plot(theo.MSDi.s.n, type = "l", xlab = "site", ylab = "Theoretical")
```

```{r}
plot(exp.MSDi.s.n, type = "l", col = "red", xlab = "site",  ylab = "Experimental")
```

```{r}
plot(theo.MSDi.s.n, type = "l", xlab = "site", ylab = "Merge")
points(exp.MSDi.s.n, col = "red", type = "l")
legend("topleft", paste("R^2", round(R2.s.n, digits = 2), " ", "MSE", signif(MSE.s.n, digits = 4)), bty = "n", text.col = "red")
```




