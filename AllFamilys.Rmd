---
title: "MSDi for all families together"
author: "Maria Laura Marcos"
output: pdf_document
---
```{r setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, echo = FALSE, message = FALSE)
```

```{r}

# Directories.
out.dir <- "OUT"

# Create vectors to keep data.
v.v.theo.MSDi = c()
v.v.exp.MSDi = c()
v.R2 = c()
v.MSE = c()

# Read input.
input.fname <- file.path("input_MainMultipleReport.csv")
input <- read.csv(input.fname)

# Print the input in the html file.
print(input)

# Create a list of selection regimens.
all.betas <- list("strong.sel", "medium.sel", "weak.sel", "no.sel")

# Start a loop for each beta.
for (beta in (all.betas)) { 
  
  # Create vectors to keep data.
  v.theo.MSDi = c()
  v.exp.MSDi = c()

  # Start a loop to read data for each family.
  for (a in (1:nrow(input))) { 
    family <- as.character(input$family)[a]
    R0 = input$R0[a]
    K.analysis = input$K.analysis[a]
  
    #Read experimental data.
    analysis.fname.id <- paste(family, "_R0_", R0,  "_beta_", beta, "_K.analysis_", K.analysis, sep = "")
  
    m.exp.dr.squarei = read.csv(file.path(out.dir, paste(analysis.fname.id, "_out_m.exp.smooth.norm.dr.squarei.csv", sep = "")))
    exp.MSDi = colMeans(m.exp.dr.squarei, na.rm = T)
  
    # Read theoretical data#
    m.theo.dr.squarei = read.csv(file.path(out.dir, paste(analysis.fname.id, "_out_m.theo.smooth.norm.dr.squarei.csv", sep = "")))
    theo.MSDi = colMeans(m.theo.dr.squarei, na.rm = T)
  
    # Fit theoretical data with experimental data.
    fit = lm(exp.MSDi ~ theo.MSDi)
    fit.MSDi = fitted.values(fit)
  
    # Save and concatenale information.
    v.theo.MSDi = c(v.theo.MSDi, fit.MSDi)
    exp.MSDi = exp.MSDi[!is.na(exp.MSDi)]
    v.exp.MSDi = c(v.exp.MSDi, exp.MSDi)

  }

  # Caluclate measures.
  R2 = cor(v.theo.MSDi, v.exp.MSDi) ^ 2  
  MSE = mean((v.theo.MSDi - v.exp.MSDi) ^ 2)
  
  v.v.theo.MSDi = c(v.v.theo.MSDi, v.theo.MSDi)
  v.v.exp.MSDi = c(v.v.exp.MSDi, v.exp.MSDi)

  v.R2 = c(v.R2, R2)
  v.MSE = c(v.MSE, MSE)
}

n.sites.all.families = length(v.v.theo.MSDi)/4
```

All families fitted smoothed and normalized MSD profiles with different selection regimens:

```{r}
plot(v.v.theo.MSDi[1:n.sites.all.families], type = "l", main = " Strong selection", xlab = "site", ylab = "Merge")
points(v.v.exp.MSDi[1:n.sites.all.families], col = "red", type = "l")
legend("topleft", paste("R ^ 2", round(v.R2[1], digits = 3), "MSE", signif(v.MSE[1], digits = 4)), bty = "n", text.col = "red")
```

```{r}
plot(v.v.theo.MSDi[(n.sites.all.families + 1):(2 * n.sites.all.families)], type = "l", main = " Medium selection", xlab = "site", ylab = "Merge")
points(v.v.exp.MSDi[(n.sites.all.families + 1):(2 * n.sites.all.families)], col = "red", type = "l")
legend("topleft", paste("R^2", round(v.R2[2], digits = 3), "MSE", signif(v.MSE[2], digits = 4)), bty = "n", text.col = "red")
```

```{r}
plot(v.v.theo.MSDi[((2 * n.sites.all.families) + 1):(3 * n.sites.all.families)], type = "l", main = " Weak selection", xlab = "site", ylab = "Merge")
points(v.v.exp.MSDi[((2 * n.sites.all.families) + 1):(3 * n.sites.all.families)], col = "red", type = "l")
legend("topleft", paste("R^2", round(v.R2[3], digits = 3), "MSE", signif(v.MSE[3], digits = 4)), bty = "n", text.col = "red")
```

```{r}
plot(v.v.theo.MSDi[((3 * n.sites.all.families) + 1):(4 * n.sites.all.families)], type = "l", main = " No selection", xlab = "site", ylab = "Merge")
points(v.v.exp.MSDi[((3 * n.sites.all.families) + 1):(4 * n.sites.all.families)], col = "red", type = "l")
legend("topleft", paste("R^2", round(v.R2[4], digits = 3), "MSE", signif(v.MSE[4], digits = 4)), bty = "n", text.col = "red")
```

*Black:* Theoretical mean.

*Red:* Experimental mean.